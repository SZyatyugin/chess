!function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var o=(e,t,r,o)=>{if(!o.piece||r[e][t].piece)return!1;switch(o.piece.type){case"Rook":return e===o.row||t===o.col;case"Pawn":case"Bishop":case"King":return!1}return r};var n=(e,t)=>`\n    <div class="board">\n    ${e.map((r,n)=>`<div class="row">${((e,t,r,n)=>e.map((e,c)=>{let i=e.piece;return`<div class="cell ${c%2^t%2?"black":"white"} \n        ${i?"black"===i.color?"piece-black":"piece-white":" "} \n        ${o(t,c,r,n)?"moveable":""} \n        ${n.piece&&n.row===t&&n.col===c?"selected":" "} "\n        data-row=${t} data-col=${c}>${i?i.symbol:" "}</div>`}).join(" "))(r,n,e,t)}</div>`).join(" ")}\n    </div>\n    `;const c={Pawn:{type:"Pawn",symbol:"♙"},Bishop:{type:"Bishop",symbol:"♗"},Knight:{type:"Knight",symbol:"♘"},Rook:{type:"Rook",symbol:"♖"},Queen:{type:"Queen",symbol:"♕"},King:{type:"King",symbol:"♔"}},i=(e,t,r)=>({...e,color:t,id:r}),l=[...Object.keys(c).map(e=>i(c[e],"black",c[e].type+".black")),...Object.keys(c).map(e=>i(c[e],"white",c[e].type+".white"))];const s=e=>e.map(e=>`<div class='piece' draggable='true' id=${e.id}>${e.symbol}</div>`).join("");var a=e=>`\n<div class="box">\n<div class='box-pieces box-white'>${s(e.white)}</div>\n<div class='box-pieces box-black'>${s(e.black)}</div>\n</div>\n`;const d={piece:null,move:!1},u={board:new Array(8).fill(null).map(()=>new Array(8).fill(null).map(()=>({...d}))),selected:{piece:null,row:0,col:0},figure:{white:l.filter(e=>"white"===e.color),black:l.filter(e=>"black"===e.color)}};console.log(u.figure.white);class p{constructor(){this.history=[],this.store=JSON.parse(JSON.stringify(u))}getStore(){return JSON.parse(JSON.stringify(this.store))}setStore(e){this.store={...this.store,...e},this.history.push(JSON.stringify(this.store))}back(){const e=this.history.pop();this.store=e?JSON.parse(e):u}}var b=()=>{document.querySelectorAll(".piece").forEach(e=>e.addEventListener("dragstart",e=>{e.dataTransfer.setData("piece_type",e.target.id)}))};var f=(e,t)=>{document.querySelectorAll(".cell").forEach(r=>{const{row:n,col:c}=r.dataset;r.addEventListener("dragover",e=>e.preventDefault(),!1),r.addEventListener("drop",r=>{r.preventDefault();let o=r.dataTransfer.getData("piece_type");const i=l.find(e=>e.id===o);console.log(n,c,o,i);let s=e.getStore();s.board[+n][+c].piece=i,e.setStore(s),t()}),r.addEventListener("click",()=>{let r=e.getStore();const i=r.board[+n][+c].piece;i?(r.selected.piece=i,r.selected.row=+n,r.selected.col=+c,e.setStore(r)):o(+n,+c,r.board,r.selected)&&(r.board[+n][+c].piece=r.selected.piece,r.board[r.selected.row][r.selected.col].piece=null,r.selected.row=+n,r.selected.col=+c,e.setStore(r)),t()},!1)})};var y=(e,t)=>{document.querySelector("#back").addEventListener("click",()=>{e.back();t()})};var v=(e,t)=>{b(e,t),f(e,t),y(e,t)};var h=()=>"<button id='back' class='back-button'>back</button>";var g=e=>{const t=new p,r=()=>{const o=t.getStore();e.innerHTML=`\n      ${n(o.board,o.selected)}\n      ${a(o.figure)}\n      ${h()}\n    `,v(t,r)};r()};const m=document.getElementById("root");if(!m)throw new Error("The root element is undefined");g(m)}]);